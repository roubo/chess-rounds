# 回合计数记录微信小程序项目规划

## 项目概述

本项目旨在开发一个名为"回合"的计数记录微信小程序，用于记录和管理棋牌游戏的回合数据，提供数据统计和分析功能。

## 技术架构

### 基础设施
- **域名**: airoubo.com（阿里云）
- **服务器**: 腾讯云 Ubuntu 系统（root用户）
- **HTTPS**: 使用开源免费方案（Let's Encrypt）
- **反向代理**: Nginx

### 前端技术栈
- **框架**: UniApp
- **平台**: 微信小程序
- **配色方案**: 
  - 主色调: #5D688A
  - 辅助色: #F7A5A5
  - 背景色: #FFDBB6
  - 浅色: #FFF2EF

### 后端技术栈
- **框架**: Spring Boot
- **数据库**: MySQL（本地部署，支持远程访问）
- **架构**: 模块化设计
- **AI集成**: DeepSeek API（数据分析和总结）

## 功能需求

### 1. 用户认证系统
- 微信登录集成
- 长期有效的登录Token
- 符合微信小程序未登录状态展示政策

### 2. 主界面设计

#### 2.1 "回合"Tab（主功能区）
- **组局功能**:
  - 扫描组局
  - 参与者限制：最多4人
  - "台板"开关（不占用参与者名额）
  - 倍率设置
  - 旁观者无限制

- **回合展示**:
  - 对手分析提示（4种程度区分）
  - 回合动态更新
  - 记录展示和操作入口

- **旁观功能**:
  - 旁观码/链接分享
  - 旁观者赞贬功能（长按头像）
  - 旁观局和参与局信息展示

#### 2.2 "我的"Tab（数据汇总区）
- **快速数据区域**:
  - 今日数据
  - 本月数据
  - 本年数据

- **图表展示**:
  - 按月展示的数据图表

- **关系分析**:
  - 最佳合伙人展示和总结
  - 最强对手展示和总结

### 3. 数据管理
- **记录操作**: 只允许添加，不支持删除和修改
- **数据分析**: 集成AI接口进行智能分析
- **容错处理**: 针对AI接口不确定性的容错机制

## 数据库设计

### 用户表 (users)
- id (主键)
- openid (微信唯一标识)
- nickname (昵称)
- avatar_url (头像)
- created_at (创建时间)
- updated_at (更新时间)

### 回合表 (rounds)
- id (主键)
- creator_id (创建者ID)
- round_code (回合码)
- multiplier (倍率)
- has_table (是否有台板)
- status (状态：进行中/已结束)
- created_at (创建时间)
- ended_at (结束时间)

### 参与者表 (participants)
- id (主键)
- round_id (回合ID)
- user_id (用户ID)
- role (角色：参与者/旁观者/台板)
- joined_at (加入时间)

### 记录表 (records)
- id (主键)
- round_id (回合ID)
- user_id (操作用户ID)
- record_type (记录类型)
- amount (金额/分数)
- description (描述)
- created_at (创建时间)

### 评价表 (ratings)
- id (主键)
- round_id (回合ID)
- from_user_id (评价者ID)
- to_user_id (被评价者ID)
- rating_type (评价类型：赞/贬)
- created_at (创建时间)

## API设计

### 用户相关
- POST /api/auth/login - 微信登录
- GET /api/user/profile - 获取用户信息
- PUT /api/user/profile - 更新用户信息

### 回合相关
- POST /api/rounds - 创建回合
- GET /api/rounds/{id} - 获取回合详情
- POST /api/rounds/{id}/join - 加入回合
- GET /api/rounds/my - 获取我的回合列表
- GET /api/rounds/spectate/{code} - 通过旁观码获取回合信息

### 记录相关
- POST /api/records - 添加记录
- GET /api/records/round/{roundId} - 获取回合记录

### 统计相关
- GET /api/stats/daily - 今日统计
- GET /api/stats/monthly - 月度统计
- GET /api/stats/yearly - 年度统计
- GET /api/stats/partners - 最佳合伙人
- GET /api/stats/opponents - 最强对手

### 评价相关
- POST /api/ratings - 添加评价
- GET /api/ratings/round/{roundId} - 获取回合评价

## 部署方案

### 服务器配置
1. 安装必要软件：Java、MySQL、Nginx
2. 配置MySQL远程访问权限
3. 申请SSL证书（Let's Encrypt）
4. 配置Nginx反向代理

### 域名配置
- 主域名：airoubo.com
- API子域名：api.airoubo.com
- 小程序后端：mp.airoubo.com

## 安全考虑

1. **数据库安全**:
   - 设置强密码
   - 限制远程访问IP
   - 定期备份

2. **API安全**:
   - JWT Token认证
   - 请求频率限制
   - 参数验证

3. **小程序安全**:
   - 敏感数据加密
   - 防止重放攻击

## 开发计划

### 第一阶段：基础环境搭建
1. 服务器环境配置
2. 数据库设计和创建
3. 基础Spring Boot项目搭建
4. Nginx配置和SSL证书申请

### 第二阶段：后端API开发
1. 用户认证模块
2. 回合管理模块
3. 记录管理模块
4. 统计分析模块

### 第三阶段：前端小程序开发
1. 基础框架搭建
2. 用户登录功能
3. 回合功能实现
4. 我的页面实现

### 第四阶段：集成和测试
1. 前后端联调
2. 功能测试
3. 性能优化
4. 上线部署

---

## 任务清单

### 环境搭建
- [x] 1.1 配置云服务器基础环境
- [x] 1.2 安装Java运行环境
- [x] 1.3 安装和配置MySQL数据库
- [x] 1.4 安装和配置Nginx
- [x] 1.5 申请和配置SSL证书
- [x] 1.6 配置域名解析

### 后端开发
- [x] 2.1 创建Spring Boot项目结构
- [x] 2.2 设计和创建数据库表
- [x] 2.3 数据库设计和创建完成
- [ ] 2.4 实现用户认证模块
- [ ] 2.5 实现回合管理API
- [ ] 2.6 实现记录管理API
- [ ] 2.7 实现统计分析API
- [ ] 2.8 集成DeepSeek AI接口
- [ ] 2.9 实现评价功能API

### 前端开发
- [x] 3.1 创建UniApp项目
- [x] 3.2 设计UI组件和样式
- [ ] 3.3 实现微信登录功能
- [ ] 3.4 实现回合Tab功能
- [ ] 3.5 实现我的Tab功能
- [ ] 3.6 实现旁观功能
- [ ] 3.7 实现数据统计页面
- [ ] 3.8 添加AI分析容错处理

### 测试和部署
- [ ] 4.1 单元测试编写
- [ ] 4.2 集成测试
- [x] 4.3 性能测试和优化
- [x] 4.4 小程序提审准备
- [x] 4.5 生产环境部署
- [ ] 4.6 监控和日志配置

### 文档和维护
- [x] 5.1 API文档编写
- [ ] 5.2 用户使用手册
- [ ] 5.3 运维文档
- [ ] 5.4 数据备份策略

**项目状态**: 开发阶段
**当前进度**: 16/31 任务完成
**预计完成时间**: 4-6周

## 补充文档

### 项目总结文档
- [x] 项目总结和文档汇总 (`project-summary.md`)

---

*注：此文档将随着项目进展持续更新，任务完成状态将实时更新以便跟踪项目进度。*